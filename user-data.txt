#!/bin/bash -xe

# Update the system
yum update -y

# Install Apache HTTP Server and create index.html (Optional)
yum install httpd -y 
echo 'Hello' >> /var/www/html/index.html 
systemctl restart httpd

# Install necessary packages (jq, aws-cli, ruby) and the CodeDeploy agent
yum install -y jq aws-cli ruby
cd /tmp
wget https://aws-codedeploy-us-east-2.s3.us-east-2.amazonaws.com/latest/install
chmod +x ./install
./install auto

# Optional: Disable auto-update for the CodeDeploy agent
echo "Disabling Auto Update"
sed -i '/@reboot/d' /etc/cron.d/codedeploy-agent-update
chattr +i /etc/cron.d/codedeploy-agent-update
